<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

  
  <title>load API documentation</title>
  <meta name="description" content="# Loading ApRES data into xarrays

The load module contains functions and classes used to load ApRES..." />


  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}
</style>
  <style type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/
</style>
  <style type="text/css">
  pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>
  <style type="text/css">
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}
</style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>
<div id="container">
  


















  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#load.generate_xarray">generate_xarray</a></li>
    <li class="mono"><a href="#load.load_zarr">load_zarr</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#load.BurstObject">BurstObject</a></span>
        
          
  <ul>
    <li class="mono"><a href="#load.BurstObject.ExtractChirp">ExtractChirp</a></li>
    <li class="mono"><a href="#load.BurstObject.PlotBurst">PlotBurst</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#load.ChirpObject">ChirpObject</a></span>
        
          
  <ul>
    <li class="mono"><a href="#load.ChirpObject.FormProfile">FormProfile</a></li>
    <li class="mono"><a href="#load.ChirpObject.PlotChirp">PlotChirp</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#load.DataFileObject">DataFileObject</a></span>
        
          
  <ul>
    <li class="mono"><a href="#load.DataFileObject.ExtractBurst">ExtractBurst</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#load.ProfileObject">ProfileObject</a></span>
        
          
  <ul>
    <li class="mono"><a href="#load.ProfileObject.PlotProfile">PlotProfile</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#load.from_dats">from_dats</a></span>
        
          
  <ul>
    <li class="mono"><a href="#load.from_dats.correct_temperature">correct_temperature</a></li>
    <li class="mono"><a href="#load.from_dats.is_this_a_remote_load">is_this_a_remote_load</a></li>
    <li class="mono"><a href="#load.from_dats.list_files">list_files</a></li>
    <li class="mono"><a href="#load.from_dats.load_all">load_all</a></li>
    <li class="mono"><a href="#load.from_dats.load_dat_file">load_dat_file</a></li>
    <li class="mono"><a href="#load.from_dats.load_single">load_single</a></li>
    <li class="mono"><a href="#load.from_dats.subset_files">subset_files</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

<article id="content">
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">load</span> module</h1>
  <h1 id="loading-apres-data-into-xarrays">Loading ApRES data into xarrays</h1>
<p>The load module contains functions and classes used to load ApRES data into xarrays. </p>
<p>There are two main ways to do this: 
1. from dat files (binary files produced by ApRES)
2. from zarr files (multi-dimensional data structures, similar to netcdfs)</p>
<h2 id="from-dat-files">From dat files</h2>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load', this);">Show source &equiv;</a></p>
  <div id="source-load" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># Loading ApRES data into xarrays</span>

<span class="sd">The load module contains functions and classes used to load ApRES data into xarrays. </span>

<span class="sd">There are two main ways to do this: </span>
<span class="sd">1. from dat files (binary files produced by ApRES)</span>
<span class="sd">2. from zarr files (multi-dimensional data structures, similar to netcdfs)</span>

<span class="sd">## From dat files</span>





<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">gcsfs</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">datetime</span>


<span class="k">def</span> <span class="nf">load_zarr</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;gs://ldeo-glaciology/apres/greenland/2022/single_zarrs_noencode/A101&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load ApRES data stored in a zarr directory as an xarray and add functionality. &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">,</span> 
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">{})</span> 

<span class="k">def</span> <span class="nf">generate_xarray</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">remote_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">file_names_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">bursts_to_process</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">,</span>
                 <span class="n">attended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">polarmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">legacy_fft</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">corrected_pad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">max_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">computeProfiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">loglevel</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
                 <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for from_dats.load_all. This slightly simplifies the process of loading ApRES data into an xarray because it avoids having to initialize the from_dats object.&quot;&quot;&quot;</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">from_dats</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">loglevel</span><span class="p">)</span>
    
    <span class="n">fd</span><span class="o">.</span><span class="n">load_all</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> 
                 <span class="n">remote_load</span><span class="o">=</span><span class="n">remote_load</span><span class="p">,</span> 
                 <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="n">file_numbers_to_process</span><span class="p">,</span> 
                 <span class="n">file_names_to_process</span><span class="o">=</span><span class="n">file_names_to_process</span><span class="p">,</span> 
                 <span class="n">bursts_to_process</span><span class="o">=</span><span class="n">bursts_to_process</span><span class="p">,</span>
                 <span class="n">attended</span><span class="o">=</span><span class="n">attended</span><span class="p">,</span> 
                 <span class="n">polarmetric</span><span class="o">=</span><span class="n">polarmetric</span><span class="p">,</span>
                 <span class="n">legacy_fft</span> <span class="o">=</span> <span class="n">legacy_fft</span><span class="p">,</span>
                 <span class="n">corrected_pad</span> <span class="o">=</span> <span class="n">corrected_pad</span><span class="p">,</span>
                 <span class="n">max_range</span> <span class="o">=</span> <span class="n">max_range</span><span class="p">,</span>
                 <span class="n">computeProfiles</span> <span class="o">=</span> <span class="n">computeProfiles</span><span class="p">,</span>
                 <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="n">addProfileToDs_kwargs</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">fd</span><span class="o">.</span><span class="n">data</span>

<span class="k">class</span> <span class="nc">from_dats</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object containing ApRES data loaded from a dat file or many dat files, along with information about the data. </span>
<span class="sd">    </span>
<span class="sd">        Can be instantiated with 2 optional keyword arguments, loglevel and max_range</span>
<span class="sd">    </span>
<span class="sd">        Argument:</span>
<span class="sd">            loglevel --- allows the user to select the level of logging messages are displayed. </span>
<span class="sd">            The default loglevel is warning, which means that no messages are displayed. </span>
<span class="sd">            If you want to see detailed log messages, use loglevel = &#39;debug&#39;</span>
<span class="sd">        </span>
<span class="sd">        Methods:</span>
<span class="sd">            load_single --- load a single chirp from a single burst from a single dat file</span>
<span class="sd">            load_dat_file --- load a dat file as a DataFileObject</span>
<span class="sd">            list_files --- recursively find  all the files in a directory or a google bucket</span>
<span class="sd">            load_all --- load all the files found in a directory or google bucket into an xarray</span>
<span class="sd">    </span>
<span class="sd">        load_all is the most important method. Call it, for example, as follows:</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">            import ApRESDefs</span>
<span class="sd">            xa = ApRESDefs.xapres(loglevel=&#39;debug&#39;, max_range=1400)</span>
<span class="sd">            xa.load_all(directory=&#39;gs://ldeo-glaciology/GL_apres_2022&#39;, </span>
<span class="sd">                        remote_load = True,</span>
<span class="sd">                        file_numbers_to_process = [0, 1], </span>
<span class="sd">                        bursts_to_process=[0, 1]</span>
<span class="sd">                    )</span>
<span class="sd">    </span>
<span class="sd">        the resulting xarray will be saved in xa.data.</span>
<span class="sd">        </span>
<span class="sd">        Instance variables:</span>
<span class="sd">            Filename           : Name of data file</span>
<span class="sd">            BurstLocationList  : Python list of byte offset of each burst in file</span>
<span class="sd">            NoBurstsInFile     : Number of bursts in the file (len(BurstLocationList))</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">(</span><span class="n">loglevel</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">load_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">dat_filename</span><span class="p">,</span> 
                    <span class="n">burst_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">chirp_num</span><span class="o">=</span><span class="mi">0</span>
                    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a single chirp, from a single burst, from a single data file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files_to_be_processed</span> <span class="o">=</span> <span class="n">dat_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Load dat file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dat_file</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract burst number </span><span class="si">{</span><span class="n">burst_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_burst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_dat</span><span class="o">.</span><span class="n">ExtractBurst</span><span class="p">(</span><span class="n">burst_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract chirp number </span><span class="si">{</span><span class="n">chirp_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_chirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_burst</span><span class="o">.</span><span class="n">ExtractChirp</span><span class="p">([</span><span class="n">chirp_num</span><span class="p">])</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Form profile for chirp number </span><span class="si">{</span><span class="n">chirp_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_chirp</span><span class="o">.</span><span class="n">FormProfile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to load_single.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_dat_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat_filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a DataFileObject, given a filename.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataFileObject</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">)</span>
      
    <span class="k">def</span> <span class="nf">list_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                   <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                   <span class="n">search_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                   <span class="p">):</span>    
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursively list all the .DAT files in a given location dir. </span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">        directory -- the directory that will be looked in recursivly to find .DAT files.</span>
<span class="sd">        search_suffix -- a string that can be used to search for files with a specific suffix.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Find all the dat files in the directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>   
            <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
            <span class="n">dat_filenames_without_gs_prefix</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="o">+</span> <span class="n">search_suffix</span> <span class="o">+</span> <span class="s1">&#39;.[dD][aA][tT]&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">dat_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gs://&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dat_filenames_without_gs_prefix</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dat_filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="o">+</span> <span class="n">search_suffix</span>  <span class="o">+</span><span class="s1">&#39;.[dD][aA][tT]&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span> <span class="o">=</span> <span class="n">dat_filenames</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to list_files. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dat_filenames</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>

        
        <span class="k">return</span> <span class="n">dat_filenames</span>
          
    <span class="k">def</span> <span class="nf">load_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">remote_load</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">file_names_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">bursts_to_process</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">,</span>
                 <span class="n">attended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">polarmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">legacy_fft</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">corrected_pad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">max_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">computeProfiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                 <span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to recursively ApRES .dat files and put them in an xarray dataset. It also computes profiles from the chirp data </span>
<span class="sd">        and includes them in the output. </span>
<span class="sd">        </span>
<span class="sd">        This method has two modes. One for unattended ApRES data and one for attended data. </span>
<span class="sd">        </span>
<span class="sd">        For unattended data (i.e. attended=False, the default), it puts all the data from all </span>
<span class="sd">        the .DAT files found recursively in &#39;directory&#39;, into one xarray. The most important </span>
<span class="sd">        dimension of this xarray is &#39;time&#39;, which is the time of each burst. </span>

<span class="sd">        In attended mode, the method locates the dat files corresponding to each waypoint. </span>
<span class="sd">        It does this based on a user-supplied list of directories &#39;directory&#39;. The method groups the </span>
<span class="sd">        data by waypoint (and optionally antenna orientation).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str or list, optional</span>
<span class="sd">            Directory or list of directories containing .DAT files. </span>
<span class="sd">            If attended is False, this should be a single directory which will be search recusrivley for dat fies.  </span>
<span class="sd">            If attended is True, this should be a list of directories, one for each waypoint. Default is None.</span>
<span class="sd">        file_numbers_to_process : list, optional</span>
<span class="sd">            List of file numbers to process. If None, all files will be processed. Default is None.</span>
<span class="sd">        file_names_to_process : list, optional</span>
<span class="sd">            List of file names to process. If None, all files will be processed. Default is None. </span>
<span class="sd">            Note that you can set either file_numbers_to_process or file_names_to_process, but not both. </span>
<span class="sd">        bursts_to_process : str or list, optional</span>
<span class="sd">            Bursts to process from within each dat file. Default is &quot;All&quot;.</span>
<span class="sd">        attended : bool, optional</span>
<span class="sd">            If True, load data in attended mode. Default is False.</span>
<span class="sd">        polarmetric : bool, optional</span>
<span class="sd">            If True, load data in polarmetric mode - the xarray dataset outputted will have an antenna-orientation dimension corrosponding to HH, HV, VH, and VV. </span>
<span class="sd">            It designates dat files to each orientation based on the files names containing HH, HV, VH, or VV.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        legacy_fft : bool, optional</span>
<span class="sd">            If True, use legacy FFT processing. Default is True.</span>
<span class="sd">        corrected_pad : bool, optional</span>
<span class="sd">            If True, use the corrected padding procedure in the legacy fft processing.</span>
<span class="sd">            The original erroneously replaced a two data points in each chirp with zeros. Default is False.</span>
<span class="sd">        max_range : float, optional</span>
<span class="sd">            A range value used to crop the profiles. Only used in the legacy fft processing. Default is None.</span>
<span class="sd">        computeProfiles : bool, optional</span>
<span class="sd">            If True, compute profiles from the chirp data. Default is True.</span>
<span class="sd">        addProfileToDs_kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments for addProfileToDs method. </span>
<span class="sd">            The following can be set:</span>
<span class="sd">                pad_factor = 2</span>
<span class="sd">                drop_noisy_chirps = False,</span>
<span class="sd">                clip_threshold = 1.2,</span>
<span class="sd">                min_chirps = 20,</span>
<span class="sd">                demean = False,</span>
<span class="sd">                detrend = False,</span>
<span class="sd">                stack = False,</span>
<span class="sd">                crop_chirp_start = None,</span>
<span class="sd">                crop_chirp_end = None,</span>
<span class="sd">                max_range = None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xarray.Dataset</span>
<span class="sd">            The loaded data as an xarray dataset.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If attended mode is True and directory_list is None.</span>
<span class="sd">            If both file_numbers_to_process and file_names_to_process are supplied.</span>
<span class="sd">        &quot;&quot;&quot;</span>   

        <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="o">=</span> <span class="n">file_numbers_to_process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="o">=</span> <span class="n">file_names_to_process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attended</span> <span class="o">=</span> <span class="n">attended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burst_load_counter</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># this will increment each time a burst is loaded by _burst_to_xarray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polarmetric</span> <span class="o">=</span> <span class="n">polarmetric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span> <span class="o">=</span> <span class="n">legacy_fft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corrected_pad</span> <span class="o">=</span> <span class="n">corrected_pad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="o">=</span> <span class="n">max_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">computeProfiles</span> <span class="o">=</span> <span class="n">computeProfiles</span>
        <span class="c1">#self.bursts_to_process = bursts_to_process</span>
        
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start call to load_all with remote_load = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="si">}</span><span class="s2">, directory = </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">, file_numbers_to_process = </span><span class="si">{</span><span class="n">file_numbers_to_process</span><span class="si">}</span><span class="s2">, file_names_to_process = </span><span class="si">{</span><span class="n">file_names_to_process</span><span class="si">}</span><span class="s2">, bursts_to_process = </span><span class="si">{</span><span class="n">bursts_to_process</span><span class="si">}</span><span class="s2">, attended = </span><span class="si">{</span><span class="n">attended</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      
        
        
        <span class="k">if</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">directory_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">directory_list</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="k">if</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>    <span class="c1"># adds self.dat_filenames</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">subset_files</span><span class="p">()</span>   <span class="c1"># adds self.dat_filenames_to_process</span>
        
            <span class="c1"># Loop through the dat files, putting individual xarrays in a list.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attended is False, so starting loop over dat files&quot;</span><span class="p">)</span>
            <span class="n">list_of_multiBurstxarrays</span> <span class="o">=</span> <span class="p">[]</span>   
            <span class="k">for</span> <span class="n">dat_filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Load dat file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dat_file</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>
                
                <span class="n">multiBurstxarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_bursts_in_dat_to_xarray</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">bursts_to_process</span><span class="p">)</span>
            
                <span class="n">list_of_multiBurstxarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiBurstxarray</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished processing file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attended is False, so concatenating all the multi-burst xarrays along the time dimension, to create xapres.data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_multiBurstxarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> 
        
            

        <span class="k">elif</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">directory_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Throwing a ValueError because directory_list is None and attended is True: when loaded data taken in attended mode, you must supply a list of directory names.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When loading data taken in attended mode, you must supply a list, directory_list, with the names of directories containing dat files from each waypoint.&quot;</span><span class="p">)</span>
            
            <span class="c1"># loop over the waypoints, as defined by the directories in the user-supplied list, directory_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attended is True, so starting loop over directories (each corresponding to a waypoint)&quot;</span><span class="p">)</span>
            <span class="n">list_of_singlewaypoint_xarrays</span> <span class="o">=</span> <span class="p">[]</span>   
            
            <span class="k">for</span> <span class="n">waypoint_number</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">directory_list</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> for dat files from waypoint </span><span class="si">{</span><span class="n">waypoint_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">singlewaypoint_xarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_bursts_at_waypoint_to_xarray</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">waypoint_number</span><span class="p">)</span>
                <span class="n">list_of_singlewaypoint_xarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">singlewaypoint_xarray</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished processing files f-in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> waypoint </span><span class="si">{</span><span class="n">waypoint_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attended is True, so concatenating all the single-waypoint xarrays along the waypoint dimension, to create xapres.data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_singlewaypoint_xarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;waypoint&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_attrs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">correct_temperature</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeProfiles</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call addProfileToDs to add the profiles to the xarray&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">addProfileToDs</span><span class="p">(</span><span class="o">**</span><span class="n">addProfileToDs_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to load_all. Call xapres.data to see the xarray this produced.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">subset_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subset files based on either file_numbers_to_process or file_names_to_process. Throws an error if both are supplied. This only gets used for unattended data.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Throwing a ValueError because file_numbers_to_process and file_names_to_process cannot both be supplied to load_all&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;file_numbers_to_process and file_names_to_process cannot both be supplied to load_all. You need to supply just one (or neither) of these.&quot;</span><span class="p">)</span> 
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because file_numbers_to_process == </span><span class="se">\&quot;</span><span class="s2">all</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subset files to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span><span class="p">]</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because file_names_to_process == </span><span class="se">\&quot;</span><span class="s2">all</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>
            <span class="k">else</span><span class="p">:</span>                 
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Subset files to list of files supplied in file_names_to_process&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span>
                            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>      <span class="c1"># default is all the dat files    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because neither file_numbers_to_process nor file_names_to_process were supplied&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>          
        
    <span class="k">def</span> <span class="nf">_all_bursts_in_dat_to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                     <span class="n">dat</span><span class="p">,</span> 
                                     <span class="n">bursts_selected</span><span class="p">,</span>
                                     <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take data from all the bursts in one .DAT file and put it in an xarray, concatenated by time. </span>
<span class="sd">        Only gets used for unattended data because attended data should only have one burst per dat file.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">        dat -- a DataFileObject  </span>
<span class="sd">        bursts_selected -- a list of the burst numbers to process, or &quot;All&quot; to process all the bursts in the dat file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attended is False. Generating xarray for unattended data&quot;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This dat file has </span><span class="si">{</span><span class="n">dat</span><span class="o">.</span><span class="n">NoBurstsInFile</span><span class="si">}</span><span class="s2"> bursts.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bursts_to_process = </span><span class="si">{</span><span class="n">bursts_selected</span><span class="si">}</span><span class="s2"> at the start of _all_bursts_in_dat_to_xarray.&quot;</span><span class="p">)</span>

        <span class="c1"># Choose which bursts to process. The default is all of the burst in each dat file).</span>
        <span class="k">if</span> <span class="n">bursts_selected</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
            <span class="n">bursts_to_process</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">NoBurstsInFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;bursts_to_process set to </span><span class="se">\&quot;</span><span class="s2">All</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bursts_to_process</span> <span class="o">=</span> <span class="n">bursts_selected</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bursts_to_process</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">NoBurstsInFile</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The burst numbers requested in bursts_to_process (</span><span class="si">{</span><span class="n">bursts_to_process</span><span class="si">}</span><span class="s2">) is greater than the number of bursts in</span><span class="se">\</span>
<span class="s2">                the dat file (</span><span class="si">{</span><span class="n">dat</span><span class="o">.</span><span class="n">NoBurstsInFile</span><span class="si">}</span><span class="s2">), so we will just process all the bursts.&quot;</span><span class="p">)</span>
            <span class="n">bursts_to_process</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">NoBurstsInFile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;After the initial parse in _all_bursts_in_dat_to_xarray, bursts_to_process = </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">bursts_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start loop over burst numbers </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">bursts_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2"> in dat file </span><span class="si">{</span><span class="n">dat</span><span class="o">.</span><span class="n">Filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>     
        
        <span class="n">list_of_singleBurst_xarrays</span> <span class="o">=</span> <span class="p">[]</span>     
        <span class="c1"># Loop over the selected bursts, extracting each and putting it in an xarray with _burst_to_xarray_unattended, and appending it to the list list_of_singleBurst_xarrays</span>
        <span class="k">for</span> <span class="n">burst_number</span> <span class="ow">in</span> <span class="n">bursts_to_process</span><span class="p">:</span><span class="c1">#tqdm(bursts_to_process):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract burst number </span><span class="si">{</span><span class="n">burst_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>   
            <span class="n">burst</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">ExtractBurst</span><span class="p">(</span><span class="n">burst_number</span><span class="p">)</span>
            <span class="n">singleBurst_xarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burst_to_xarray_unattended</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span> <span class="o">=</span> <span class="n">burst</span>
            <span class="n">list_of_singleBurst_xarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">singleBurst_xarray</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concatenating all the single-burst xarrays from dat file </span><span class="si">{</span><span class="n">dat</span><span class="o">.</span><span class="n">Filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># If the data was collected in unattended mode concat along the time dimension.</span>
        <span class="c1">#</span>
        <span class="c1"># If the data was collected in attended mode concat along the waypoint dimension.</span>
        <span class="c1"># match self.attended:</span>
        <span class="c1">#    case False:</span>
        <span class="c1">#        return xr.concat(list_of_singleBurst_xarrays, dim=&#39;time&#39;) </span>
        <span class="c1">#    case True:</span>
        <span class="c1">#        return xr.concat(list_of_singleBurst_xarrays, dim=&#39;waypoint&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">burst_load_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_singleBurst_xarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">_all_bursts_at_waypoint_to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                          <span class="n">directory</span><span class="p">,</span>
                                          <span class="n">waypoint_number</span><span class="p">):</span>   
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is the attended equivalent to _all_bursts_in_dat_to_xarray&quot;&quot;&quot;</span>
    
        <span class="c1"># initialize an empty array to contain the individual xarrays</span>
        <span class="n">list_of_singleorientation_attended_xarrays</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarmetric</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">orientations</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HH&#39;</span><span class="p">,</span> <span class="s1">&#39;HV&#39;</span><span class="p">,</span> <span class="s1">&#39;VH&#39;</span><span class="p">,</span> <span class="s1">&#39;VV&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orientations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>

        <span class="c1"># loop over the orientations</span>
        <span class="k">for</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="n">orientations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking for files with orientation </span><span class="si">{</span><span class="n">orientation</span><span class="si">}</span><span class="s2"> in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">search_suffix</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files with orientation </span><span class="si">{</span><span class="n">orientation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;there should by one dat file for each orientation in each directory. We found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files.&#39;</span><span class="p">)</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dat_file</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">burst</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">ExtractBurst</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">singleorientation_attended_xarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burst_to_xarray_attended</span><span class="p">(</span><span class="n">burst</span><span class="p">,</span> <span class="n">waypoint_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span> <span class="o">=</span> <span class="n">burst</span>

            <span class="c1"># append the new xarray to a list</span>
            <span class="n">list_of_singleorientation_attended_xarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">singleorientation_attended_xarray</span><span class="p">)</span>
        
        <span class="c1"># concatenate the xarrays in the list along the orientation dimension</span>
        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_singleorientation_attended_xarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;orientation&#39;</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">_burst_to_xarray_unattended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                    <span class="n">burst</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an xarray containing all data from one burst with appropriate coordinates&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Put all chirps and profiles from burst number </span><span class="si">{</span><span class="n">burst</span><span class="o">.</span><span class="n">BurstNo</span><span class="si">}</span><span class="s2"> in 3D arrays&quot;</span><span class="p">)</span>
        <span class="n">chirps</span><span class="p">,</span> <span class="n">profiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burst_to_3d_arrays</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="n">chirp_time</span><span class="p">,</span> <span class="n">profile_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords_from_burst</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp_from_burst</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Get orientation from filename&quot;</span><span class="p">)</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_orientation</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">)</span>

        <span class="n">chirps</span> <span class="o">=</span> <span class="n">chirps</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,:,:]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeProfiles</span><span class="p">:</span>
            <span class="n">profiles</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,:,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using the legacy fft method, so we will return the profiles along with the rest of the data at this stage&quot;</span><span class="p">)</span>

            <span class="n">xarray_out</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">chirp</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;chirp_time&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">chirps</span><span class="p">),</span>
                    <span class="n">profile</span>         <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_range&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">profiles</span><span class="p">),</span>
                    <span class="n">latitude</span>        <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]]),</span>
                    <span class="n">longitude</span>       <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]]),</span>  
                    <span class="n">battery_voltage</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;BatteryVoltage&#39;</span><span class="p">]]),</span> 
                    <span class="n">temperature_1</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp1&#39;</span><span class="p">]]),</span>
                    <span class="n">temperature_2</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp2&#39;</span><span class="p">]])</span>
                <span class="p">),</span>
                <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">time</span>                  <span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="p">],</span>
                    <span class="n">chirp_time</span>            <span class="o">=</span> <span class="n">chirp_time</span><span class="p">,</span>
                    <span class="n">profile_range</span>         <span class="o">=</span> <span class="n">profile_range</span><span class="p">,</span> 
                    <span class="n">chirp_num</span>             <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">]),</span>
                    <span class="n">filename</span>              <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">]),</span>
                    <span class="n">burst_number</span>          <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">BurstNo</span><span class="p">]),</span>
                    <span class="n">AFGain</span>                <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">attenuator</span>            <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">orientation</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">orientation</span><span class="p">])</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not using the legacy fft method, so we dont return the profiles at this stage, only chirps and all the other variables&quot;</span><span class="p">)</span>
            <span class="n">xarray_out</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">chirp</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="s2">&quot;chirp_time&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">chirps</span><span class="p">),</span>
                    <span class="n">latitude</span>        <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">]]),</span>
                    <span class="n">longitude</span>       <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Longitude&#39;</span><span class="p">]]),</span>  
                    <span class="n">battery_voltage</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;BatteryVoltage&#39;</span><span class="p">]]),</span> 
                    <span class="n">temperature_1</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp1&#39;</span><span class="p">]]),</span>
                    <span class="n">temperature_2</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp2&#39;</span><span class="p">]])</span>
                <span class="p">),</span>
                <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>    
                    <span class="n">time</span>                  <span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="p">],</span>
                    <span class="n">chirp_time</span>            <span class="o">=</span> <span class="n">chirp_time</span><span class="p">,</span>
                    <span class="n">chirp_num</span>             <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">]),</span>
                    <span class="n">filename</span>              <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">]),</span>
                    <span class="n">burst_number</span>          <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">burst</span><span class="o">.</span><span class="n">BurstNo</span><span class="p">]),</span>
                    <span class="n">AFGain</span>                <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">attenuator</span>            <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">orientation</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">orientation</span><span class="p">])</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">xarray_out</span>
    
    <span class="k">def</span> <span class="nf">_burst_to_xarray_attended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                  <span class="n">burst</span><span class="p">,</span> 
                                  <span class="n">waypoint_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an xarray containing all data from one burst with appropriate coordinates - for attended data&quot;&quot;&quot;</span>

        <span class="c1">#self.logger.debug(f&quot;Put all chirps and profiles from burst number {burst.BurstNo} in 3D arrays&quot;)</span>
        
        <span class="c1">#xa = ApRESDefs.xapres()</span>
        <span class="c1">#files = xa.list_files(directory=&#39;../../data&#39;)</span>
        <span class="c1">#dat = xa.load_dat_file(files[0])</span>
        <span class="c1">#burst = dat.ExtractBurst(0)</span>
        <span class="c1">#waypoint = 1</span>
        <span class="n">chirps_temp</span><span class="p">,</span> <span class="n">profiles_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burst_to_3d_arrays</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="n">chirp_time</span><span class="p">,</span> <span class="n">profile_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords_from_burst</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="n">time_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamp_from_burst</span><span class="p">(</span><span class="n">burst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Get orientation from filename&quot;</span><span class="p">)</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_orientation</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">)</span>
        
        <span class="n">chirps</span> <span class="o">=</span> <span class="n">chirps_temp</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:,:,:]</span>
        <span class="c1">#time = time_temp[None,None,:]</span>
        <span class="c1">#time = np.expand_dims(time_temp, axis=0)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span><span class="p">:</span>
            <span class="n">profiles</span> <span class="o">=</span> <span class="n">profiles_temp</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:,:,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using the legacy fft method, so we will return the profiles along with the rest of the data at this stage&quot;</span><span class="p">)</span>
            <span class="n">xarray_out</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">chirp</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_time&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">chirps</span><span class="p">),</span>
                    <span class="n">profile</span>         <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_range&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">profiles</span><span class="p">),</span>
                    <span class="n">latitude</span>        <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">longitude</span>       <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">battery_voltage</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;BatteryVoltage&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">temperature_1</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp1&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">temperature_2</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp2&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
                <span class="p">),</span>
                <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">time</span>                  <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_temp</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">chirp_time</span>            <span class="o">=</span> <span class="n">chirp_time</span><span class="p">,</span>
                    <span class="n">profile_range</span>         <span class="o">=</span> <span class="n">profile_range</span><span class="p">,</span> 
                    <span class="n">chirp_num</span>             <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">]),</span>
                    <span class="n">filename</span>              <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span> 
                    <span class="n">burst_number</span>          <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">BurstNo</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>   
                    <span class="n">AFGain</span>                <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">attenuator</span>            <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">orientation</span>           <span class="o">=</span> <span class="p">[</span><span class="n">orientation</span><span class="p">],</span>
                    <span class="n">waypoint</span>              <span class="o">=</span> <span class="p">[</span><span class="n">waypoint_number</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not using the legacy fft method, so we dont return the profiles at this stage, only chirps and all the other variables&quot;</span><span class="p">)</span>
            <span class="n">xarray_out</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">chirp</span>           <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_time&quot;</span><span class="p">,</span> <span class="s2">&quot;chirp_num&quot;</span><span class="p">,</span> <span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">chirps</span><span class="p">),</span>
                    <span class="n">latitude</span>        <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">longitude</span>       <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Latitude&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">battery_voltage</span> <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;BatteryVoltage&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">temperature_1</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp1&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">temperature_2</span>   <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Temp2&#39;</span><span class="p">],</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
                <span class="p">),</span>
                <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">time</span>                  <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">time_temp</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">chirp_time</span>            <span class="o">=</span> <span class="n">chirp_time</span><span class="p">,</span>
                    <span class="n">chirp_num</span>             <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">]),</span>
                    <span class="n">filename</span>              <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span> 
                    <span class="n">burst_number</span>          <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;waypoint&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">BurstNo</span><span class="p">,</span> <span class="n">ndmin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)),</span>   
                    <span class="n">AFGain</span>                <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">attenuator</span>            <span class="o">=</span> <span class="p">([</span><span class="s2">&quot;attenuator_setting_pair&quot;</span><span class="p">],</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]]),</span>
                    <span class="n">orientation</span>           <span class="o">=</span> <span class="p">[</span><span class="n">orientation</span><span class="p">],</span>
                    <span class="n">waypoint</span>              <span class="o">=</span> <span class="p">[</span><span class="n">waypoint_number</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">xarray_out</span>

    <span class="k">def</span> <span class="nf">_burst_to_3d_arrays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">burst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Put all chirps and their corresponding profiles in 3D numpy arrays.</span>
<span class="sd">        </span>
<span class="sd">        First extract every chirp in a burst and compute a profile from each one. </span>
<span class="sd">        </span>
<span class="sd">        Then put the results in two 3D numpy arrays. The 3D array for the chirp data (chirp_3d) has the following dimension lengths:</span>
<span class="sd">            - [1] burst.Header[&#39;N_ADC_SAMPLES&#39;] (=40001, by default) --&gt; number of samples in each chirp  </span>
<span class="sd">            - [2] burst.Header[&#39;NSubBursts&#39;] --&gt; the number of chirps per attenuator settingp pair </span>
<span class="sd">            - [3] burst.Header[&#39;nAttenuators&#39;] --&gt; the number of attenuator settings. </span>
<span class="sd">            </span>
<span class="sd">        The 3D array for the profile data (profile_3d) has the same lengths in the dimensions [2] and [3], but a different</span>
<span class="sd">        length of dimension [1], equal to the length of the profile obtained from the fft processing.</span>
<span class="sd">        </span>
<span class="sd">        Keyword arguments:</span>
<span class="sd">        burst -- a `BurstObject` produced by DataFileObject().ExtractBurst()</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">        chirp_3d -- 3D numpy array containing all the chirps in the supplied burst</span>
<span class="sd">        cropped_profile_3d -- 3D numpy array containing all the profiles from all the chirps in this burst        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#self.logger.debug(f&quot;Set max range from _burst_to_3d_arrays&quot;)</span>
        <span class="c1">#if self.legacy_fft:      </span>
        <span class="c1">#    self._set_max_range(burst)</span>
        
        <span class="c1"># pre-allocate 3D numpy arrays</span>
        <span class="n">chirp_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;N_ADC_SAMPLES&#39;</span><span class="p">],</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">],</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]))</span>
        <span class="n">test_profile</span> <span class="o">=</span> <span class="n">burst</span><span class="o">.</span><span class="n">ExtractChirp</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">FormProfile</span><span class="p">()</span>
        <span class="n">profile_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">test_profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">),</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NSubBursts&#39;</span><span class="p">],</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    
        <span class="c1"># initialize counters for second and third dimensions of our 3D arrays respectively </span>
        <span class="n">chirp_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># loop over all chirps in this burst</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NChirps&#39;</span><span class="p">]):</span>
            <span class="n">chirp_new</span> <span class="o">=</span> <span class="n">burst</span><span class="o">.</span><span class="n">ExtractChirp</span><span class="p">([</span><span class="n">i</span><span class="p">])</span> 
            <span class="n">chirp_3d</span><span class="p">[:,</span><span class="n">chirp_counter</span><span class="p">,</span><span class="n">setting_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">chirp_new</span><span class="o">.</span><span class="n">vdat</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using legacy fft method to compute profiles&quot;</span><span class="p">)</span>
                <span class="n">profile_new</span> <span class="o">=</span> <span class="n">chirp_new</span><span class="o">.</span><span class="n">FormProfile</span><span class="p">(</span><span class="n">corrected_pad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">corrected_pad</span><span class="p">)</span>
                <span class="n">profile_3d</span><span class="p">[:,</span><span class="n">chirp_counter</span><span class="p">,</span><span class="n">setting_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile_new</span><span class="o">.</span><span class="n">Profile</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not using legacy fft method, so returning some None&#39;s&quot;</span><span class="p">)</span>
                <span class="n">profile_new</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">profile_3d</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="c1"># keep track of which pair of settings we are using</span>
            <span class="n">setting_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">setting_counter</span> <span class="o">&gt;=</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]:</span> <span class="c1"># if the counter reaches nAttenuators, reset it to zero </span>
                <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">chirp_counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using legacy fft method to compute profiles, so crop based on max_depth (if it is set)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                 
                <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">profile_new</span><span class="o">.</span><span class="n">Range</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_range</span><span class="p">)</span>
                <span class="n">cropped_profile_3d</span> <span class="o">=</span> <span class="n">profile_3d</span><span class="p">[:</span><span class="n">n</span><span class="p">,:,:]</span>  
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">cropped_profile_3d</span> <span class="o">=</span> <span class="n">profile_3d</span>  
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not using legacy fft method, so returning cropped_profile as None&quot;</span><span class="p">)</span>
            <span class="n">cropped_profile_3d</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">chirp_3d</span><span class="p">,</span> <span class="n">cropped_profile_3d</span>

    <span class="k">def</span> <span class="nf">_coords_from_burst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">burst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the time vector and depth vector from the first chirp in a burst. They should be the same for the whole burst.&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set max range from _coords_from_burst&quot;</span><span class="p">)</span>
        
        <span class="n">chirp</span> <span class="o">=</span> <span class="n">burst</span><span class="o">.</span><span class="n">ExtractChirp</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span><span class="p">:</span>
            <span class="c1">#self._set_max_range(burst)</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">chirp</span><span class="o">.</span><span class="n">FormProfile</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                
                <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">Range</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_range</span><span class="p">)</span>
                <span class="n">cropped_range</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Range</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cropped_range</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Range</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cropped_range</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span>  <span class="n">chirp</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">cropped_range</span>

    <span class="k">def</span> <span class="nf">_timestamp_from_burst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">burst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the time stamp of a burst&quot;&quot;&quot;</span>  
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Time stamp&quot;</span><span class="p">])</span>  

    <span class="k">def</span> <span class="nf">_get_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="n">orientation</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1">#add funciton to make sure orientation is capitalized</span>

        <span class="c1">#if no orientation at end of filename, mark as unknown</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HH&#39;</span><span class="p">,</span><span class="s1">&#39;HV&#39;</span><span class="p">,</span><span class="s1">&#39;VH&#39;</span><span class="p">,</span><span class="s1">&#39;VV&#39;</span><span class="p">]:</span>
            <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>

        <span class="k">return</span> <span class="n">orientation</span>
    
    <span class="k">def</span> <span class="nf">_set_max_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">burst</span><span class="p">):</span>
        
        <span class="c1"># if not supplied with a max_range, use what is defined in the header</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="o">=</span> <span class="n">burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;maxDepthToGraph&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max_range has been set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_range</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
 
    <span class="k">def</span> <span class="nf">_add_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add attributes to the xarray self.data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding attributes to the xapres.data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;time of burst&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp_time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;time of samples during chirps&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp_time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;time of samples during chirps&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp_time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;seconds&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp_num</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;chirp number&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp_num</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;the number of each chirp within each burst&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AFGain</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;audio-frequency gain control setting&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AFGain</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;decibels&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attenuator</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;radio-frequency attenuator setting&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attenuator</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;decibels&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;de-ramped chirp&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;volts&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">chirp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;voltage from the analog-to-digital converter after the received signal has been mixed with the transmitted signal and the result has been filtered to leave only the low frequency compponent corresponding to the differences in the frequencies of the Tx and Rx signals&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;latitude of burst&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;longitude of burst&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">battery_voltage</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;volts&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">battery_voltage</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;battery voltage&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">temperature_1</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;celsius&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">temperature_1</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temperature measured inside the ApRES unit in one location&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">temperature_2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;celsius&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">temperature_2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temperature measured inside the ApRES unit in a second location&#39;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;the name of the file that contains each burst&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">burst_number</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;the number of each burst within each file&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;constants&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;c0&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;f_1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;StartFreq&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;f_2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;StopFreq&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;ep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;ER_ICE&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;f_c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;CentreFreq&#39;</span><span class="p">]}</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HH, HV, VH, or VV antenna orientation as described in Ersahadi et al 2022 doi:10.5194/tc-16-1719-2022&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;processing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Created on </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attended</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">waypoint</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;the number of the waypoint where the data was collected&#39;</span>
       
    <span class="k">def</span> <span class="nf">correct_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">correction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Correct temperature values that are above a certain threshold. This appears to result from the temperature data being in the wrong format.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correct temperature values above </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> by adding </span><span class="si">{</span><span class="n">correction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">T1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_1&#39;</span><span class="p">]</span>
        <span class="n">T2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_2&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">T1</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">T1</span><span class="o">+</span><span class="n">correction</span><span class="p">,</span> <span class="n">T1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">T2</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">T2</span><span class="o">+</span><span class="n">correction</span><span class="p">,</span> <span class="n">T2</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">_setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loglevel</span><span class="p">):</span>
        <span class="n">numeric_level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">numeric_level</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid log level: </span><span class="si">{</span><span class="n">loglevel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;default_logger&quot;</span><span class="p">)</span>
        <span class="c1"># Clear old logging handlers to avoid a build up of multiple similar handlers with repeat calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="c1"># Set stream logging level to loglevel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">numeric_level</span><span class="p">)</span>
        

        <span class="n">logStreamFormatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
            <span class="n">fmt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;%(levelname)-8s %(asctime)s </span><span class="se">\t</span><span class="s2"> %(filename)s @function %(funcName)s line %(lineno)s - %(message)s&quot;</span><span class="p">,</span> 
            <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%H:%M:%S&quot;</span>
        <span class="p">)</span>
        <span class="n">consoleHandler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">consoleHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logStreamFormatter</span><span class="p">)</span>
        <span class="n">consoleHandler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">numeric_level</span><span class="p">)</span>
               
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">consoleHandler</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stream logging level set to </span><span class="si">{</span><span class="n">loglevel</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Add console handler to logger&#39;</span><span class="p">)</span>
     
           
        <span class="n">logFileFormatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
            <span class="n">fmt</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;%(levelname)s %(asctime)s (%(relativeCreated)d) </span><span class="se">\t</span><span class="s2"> %(pathname)s F%(funcName)s L%(lineno)s - %(message)s&quot;</span><span class="p">,</span>
            <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">fileHandler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;generating_xarrays_from_dats.log&#39;</span><span class="p">)</span>
        <span class="n">fileHandler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logFileFormatter</span><span class="p">)</span>
        <span class="n">fileHandler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">numeric_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fileHandler</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File logging level set to </span><span class="si">{</span><span class="n">loglevel</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">is_this_a_remote_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect if we are trying to load from Google Cloud Storage based on the filename being supplied&quot;&quot;&quot;</span>
        
        <span class="n">name_to_check_for_gs</span> <span class="o">=</span> <span class="n">filename</span> <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span> <span class="o">=</span> <span class="s2">&quot;gs://&quot;</span> <span class="ow">in</span> <span class="n">name_to_check_for_gs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;remote_load set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_try_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple test of the diffrent logging levels. Not for use by users&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;debugging something&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;some message&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;something went wrong&quot;</span><span class="p">)</span>
 

<span class="k">class</span> <span class="nc">DataFileObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object containing information about an ApRES dat file and a method to extract bursts from it, instantiating a BurstObject.</span>

<span class="sd">    Can be instantiated with one required string, giving the name of the data file</span>
<span class="sd">    eg fileDescriptor = DataFileObject(&#39;DATAFILENAME.DAT&#39;). </span>
<span class="sd">    </span>
<span class="sd">    You can also specify whether the file is stored locally or </span>
<span class="sd">    remotely (on Google Cloud Storage) with the optional argument remote_load=True.</span>

<span class="sd">    Methods:</span>
<span class="sd">        ExtractBurst(BurstNumber (integer))</span>
<span class="sd">            Output is an instance of a BurstObject</span>
<span class="sd">        e.g., Burst = fileDescriptor.ExtractBurst(3)</span>

<span class="sd">    Instance variables:</span>
<span class="sd">        Filename           : Name of data file</span>
<span class="sd">        BurstLocationList  : Python list of byte offset of each burst in file</span>
<span class="sd">        NoBurstsInFile     : Number of bursts in the file (len(BurstLocationList))</span>
<span class="sd">    </span>
<span class="sd">    Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Filename</span><span class="p">,</span> <span class="n">remote_load</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="n">Filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span> <span class="o">=</span> <span class="n">remote_load</span>
        

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            

        <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>     
        
        <span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;*** Burst Header ***&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">locn</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locn</span><span class="p">)</span>
            <span class="n">locn</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">locn</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">NoBurstsInFile</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ExtractBurst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BurstNo</span><span class="p">):</span>
        <span class="n">Burst</span> <span class="o">=</span> <span class="n">BurstObject</span><span class="p">()</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="n">BurstNo</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;BurstNo&quot;</span><span class="p">:</span><span class="n">BurstNo</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
 
        
        <span class="n">datafile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="p">[</span><span class="n">BurstNo</span><span class="p">])</span>
        <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
        <span class="n">locn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">locn1</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0D\x0A</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">locn</span><span class="p">,</span> <span class="n">locn</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span>
        <span class="n">inline</span> <span class="o">=</span> <span class="n">inbuff</span><span class="p">[</span><span class="n">locn</span><span class="p">:</span><span class="n">locn1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">inline</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;End Header&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">inline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rxant&quot;</span> <span class="ow">or</span> \
                   <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;txant&quot;</span> <span class="ow">or</span> \
                   <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;afgain&quot;</span><span class="p">:</span>
                   <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
                        <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
                        
                <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;triples&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;attenuator1&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;batterycheck&quot;</span><span class="p">:</span>
                     <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
                        <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
                                      
                <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;temp1&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;temp2&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;batteryvoltage&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tstepup&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tstepdn&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fsc&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sw_issue&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;er_ice&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;position_depth_conversion&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;maxdepthtograph&quot;</span><span class="p">:</span>
                    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    
                <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rmb_issue&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vab_issue&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg00&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg01&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg02&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg03&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0b&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0c&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0d&quot;</span> <span class="ow">or</span> \
                     <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0e&quot;</span><span class="p">:</span>
                    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;time stamp&quot;</span><span class="p">:</span>
                    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    
            <span class="n">locn</span> <span class="o">=</span> <span class="n">locn1</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">locn1</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0D\x0A</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">locn</span><span class="p">,</span><span class="n">locn</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span>
            <span class="n">inline</span> <span class="o">=</span> <span class="n">inbuff</span><span class="p">[</span><span class="n">locn</span><span class="p">:</span><span class="n">locn1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="c1"># Re-open the file for binary read to get burst data</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
            <span class="n">datafile</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>      
        
        <span class="n">datafile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="p">[</span><span class="n">BurstNo</span><span class="p">]</span> <span class="o">+</span> <span class="n">locn1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
            <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">*</span><span class="mf">2.5</span><span class="o">-</span><span class="mf">1.25</span>
        <span class="k">elif</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
            <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span> <span class="o">*</span>  <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;nAttenuators&quot;</span><span class="p">]</span>  <span class="c1"># because each subburst contains a certain number of chirps given by Burst.Header[&quot;nAttenuators&quot;]</span>
            <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">*</span><span class="mf">2.5</span><span class="o">-</span><span class="mf">1.25</span>
        <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;SamplingFreqMode&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;SamplingFreqMode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">40000</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">80000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">40000</span>
            
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NChirps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;nAttenuators&quot;</span><span class="p">]</span> <span class="o">*</span>\
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;TxAnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;RxAnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s2">&quot;FreqStepUp&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">:</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;FreqStepUp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;TStepUp&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2e8</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2e8</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4e8</span>
            
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3e8</span>
        <span class="k">if</span>  <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;ER_ICE&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">):</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.18</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span>
        
        <span class="c1"># deal out attenuator settings to the chirps</span>
        <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">]</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">chirp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NChirps&#39;</span><span class="p">]):</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="n">setting_counter</span><span class="p">])</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="n">setting_counter</span><span class="p">])</span>
            
            <span class="c1"># keep track of which setting to use</span>
            <span class="n">setting_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">setting_counter</span> <span class="o">&gt;=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]:</span> <span class="c1"># if the counter reaches nAttenuators, reset it to zero </span>
                <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">Burst</span>


<span class="k">class</span> <span class="nc">BurstObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Burst object, containing the raw data and header information for a single burst, and a method for</span>
<span class="sd">    extracting a chirp from the burst and instantiating a ChirpObject.</span>

<span class="sd">    A burst object can be instantiated with a call to DataFileObject().ExtractBurst()</span>
<span class="sd">    e.g., Burst = fileDescriptor.ExtractBurst(3)</span>

<span class="sd">    Methods:</span>
<span class="sd">        ExtractChirp(ChirpList (Python list))</span>
<span class="sd">            Output is an instance of a ChirpObject, in which all chirps in the ChirpList</span>
<span class="sd">            have been averaged. </span>
<span class="sd">        PlotBurst()</span>
<span class="sd">            Plots the full raw burst as a time series</span>

<span class="sd">    Instance variables:</span>
<span class="sd">        v         : Array containing burst data</span>
<span class="sd">        Filename  : Name of data file</span>
<span class="sd">        Header    : Burst header (Python dictionary), with additional entries:</span>
<span class="sd">        BurstNo   : Burst number in data file</span>
<span class="sd">    </span>
<span class="sd">    Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">ExtractChirp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ChirpList</span><span class="p">):</span>
        <span class="n">Chirp</span> <span class="o">=</span> <span class="n">ChirpObject</span><span class="p">()</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>  <span class="c1"># we dont want chirp-specific new entries in the chirp.header updating the burst.header</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="n">ChirpList</span>
        
        <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">]</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">])</span>\
            <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">]):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;This is stacking over chirps with different attenuator settings.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>          
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>          
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">])</span>
            <span class="n">no</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NChirps&quot;</span><span class="p">]:</span>
                    <span class="n">no</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">chirpoffset</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
                    <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">chirpoffset</span><span class="p">:</span><span class="n">chirpoffset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;chirp index &gt; number of chirps.&quot;</span><span class="p">)</span>
            <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span><span class="o">/</span><span class="n">no</span>

        <span class="k">return</span> <span class="n">Chirp</span>
        
    <span class="k">def</span> <span class="nf">PlotBurst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.25</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ChirpObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object containing the raw data and header information for a single chirp </span>
<span class="sd">    and a method for computing profiles (and instantiating a ProfileObject) from the chirp data.</span>

<span class="sd">    Can be instantiated with a call to the ExtractChirp method on a BurstBbject</span>
<span class="sd">    e.g., Chirp = Burst.ExtractChirp([1,3])</span>

<span class="sd">    Methods:</span>
<span class="sd">        FormProfile(StartFreq, StopFreq, padfactor, ref)</span>
<span class="sd">            StartFreq, StopFreq: start and end frequencies to use (eg 2e8 and 4e8)</span>
<span class="sd">            padfactor:           zero padding for the fft (eg. 2)</span>
<span class="sd">            ref:                 whether or not to apply Paul Brennan&#39;s reference</span>
<span class="sd">                                 phase (1 or 0, for yes or no)</span>
<span class="sd">            Returns and instance of a ProfileObject</span>
<span class="sd">        PlotChirp()</span>
<span class="sd">            Plots the chirp as function of time</span>

<span class="sd">    Instance variables:</span>
<span class="sd">        vdat:       Array containing chirp data</span>
<span class="sd">        t:          Array containing time for chirp samples</span>
<span class="sd">        ChirpList:  List of chirps averaged to make vdat</span>
<span class="sd">        Filename:   Name of data file</span>
<span class="sd">        BurstNo:    Number of burst within data file</span>
<span class="sd">        Header:     Burst header, as created by ExtractBurst method on FileDataObject</span>
<span class="sd">        </span>
<span class="sd">        Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">PlotChirp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdat</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.25</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">FormProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F0</span><span class="o">=</span><span class="mi">200000000</span><span class="p">,</span> <span class="n">F1</span><span class="o">=</span><span class="mi">400000000</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">corrected_pad</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">Profile</span> <span class="o">=</span> <span class="n">ProfileObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">F0</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">F1</span><span class="p">:</span>
            <span class="n">F1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="p">(</span><span class="n">F0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span>
        <span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">F1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span>
        <span class="n">chirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdat</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">T0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]):</span>\
                          <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">])]</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">winchirp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">chirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nt</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">Nt</span><span class="p">))</span>
        <span class="n">Nfft</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">*</span><span class="n">pad</span><span class="p">)</span>

        <span class="n">padchirp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nfft</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">corrected_pad</span><span class="p">:</span>
            <span class="n">padchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>
            <span class="n">padchirp</span><span class="p">[</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">padchirp</span><span class="p">[</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    
        <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">padchirp</span><span class="p">)</span><span class="o">/</span><span class="n">Nfft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pad</span><span class="p">)</span> 
        <span class="n">Profile</span><span class="o">.</span><span class="n">bin2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">T1</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="n">pad</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">])</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nfft</span><span class="p">)])</span> <span class="o">*</span> <span class="n">Profile</span><span class="o">.</span><span class="n">bin2m</span>       
        <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">))])</span><span class="o">/</span><span class="n">pad</span>
            <span class="n">phiref</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">-</span>\
             <span class="n">m</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">phiref</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">))</span>
        
        <span class="n">Profile</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BurstNo</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChirpList</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">rad2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">])</span><span class="o">/</span> \
            <span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">Profile</span>


<span class="k">class</span> <span class="nc">ProfileObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An object containing the profile data and header information for a single profile.</span>
<span class="sd">    Also includes a function for plotting the profile (which is not used in the rest of the module).</span>

<span class="sd">    Can be instantiated with a call to the FormProfile method on a ChirpObject</span>
<span class="sd">    e.g., Profile = Chirp.FormProfile(StartFreq, StopFreq, padfactor, ref)</span>

<span class="sd">    Methods:</span>
<span class="sd">        PlotProfile(MaxDepth (double))</span>
<span class="sd">            MaxDepth:  Maximum depth (in metres) to which to plot profile</span>
<span class="sd">            </span>
<span class="sd">    Instance variables:</span>
<span class="sd">        Range:     Array with depth in metres each profile depth bin</span>
<span class="sd">        Profile:   Array containing profile (complex double)</span>
<span class="sd">        F0:        Start frequency used to form profile</span>
<span class="sd">        F1:        End frequency used to form profile</span>
<span class="sd">        pad:       Pad factor used when zeropadding</span>
<span class="sd">        ChirpList: List of chirps averaged to form profile</span>
<span class="sd">        Filename:  Name of original data file </span>
<span class="sd">        BurstNo:   Number of burst in data file</span>
<span class="sd">        Header:    Burst header, as produced using ExtractBurst method on DataFileObject </span>
<span class="sd">        rad2m:     radians to metres of range conversion factor</span>
<span class="sd">        bin2m:     bin to metres of range conversion factor</span>

<span class="sd">        Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Range</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F0</span> <span class="o">=</span> <span class="mf">2e8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F1</span> <span class="o">=</span> <span class="mf">4e8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rad2m</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin2m</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">PlotProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmax</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Range</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Range (m)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (dB)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>

        <span class="k">return</span> 
</pre></div>

  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="load.generate_xarray">
    <p>def <span class="ident">generate_xarray</span>(</p><p>directory=None, remote_load=False, file_numbers_to_process=None, file_names_to_process=None, bursts_to_process=&#39;All&#39;, attended=False, polarmetric=False, legacy_fft=False, corrected_pad=False, max_range=None, computeProfiles=True, addProfileToDs_kwargs={}, loglevel=&#39;warning&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Wrapper for from_dats.load_all. This slightly simplifies the process of loading ApRES data into an xarray because it avoids having to initialize the from_dats object.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.generate_xarray', this);">Show source &equiv;</a></p>
  <div id="source-load.generate_xarray" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">generate_xarray</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">remote_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">file_names_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">bursts_to_process</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">,</span>
                 <span class="n">attended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">polarmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">legacy_fft</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">corrected_pad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">max_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">computeProfiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="p">{},</span>
                 <span class="n">loglevel</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
                 <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for from_dats.load_all. This slightly simplifies the process of loading ApRES data into an xarray because it avoids having to initialize the from_dats object.&quot;&quot;&quot;</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">from_dats</span><span class="p">(</span><span class="n">loglevel</span><span class="o">=</span><span class="n">loglevel</span><span class="p">)</span>
    
    <span class="n">fd</span><span class="o">.</span><span class="n">load_all</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> 
                 <span class="n">remote_load</span><span class="o">=</span><span class="n">remote_load</span><span class="p">,</span> 
                 <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="n">file_numbers_to_process</span><span class="p">,</span> 
                 <span class="n">file_names_to_process</span><span class="o">=</span><span class="n">file_names_to_process</span><span class="p">,</span> 
                 <span class="n">bursts_to_process</span><span class="o">=</span><span class="n">bursts_to_process</span><span class="p">,</span>
                 <span class="n">attended</span><span class="o">=</span><span class="n">attended</span><span class="p">,</span> 
                 <span class="n">polarmetric</span><span class="o">=</span><span class="n">polarmetric</span><span class="p">,</span>
                 <span class="n">legacy_fft</span> <span class="o">=</span> <span class="n">legacy_fft</span><span class="p">,</span>
                 <span class="n">corrected_pad</span> <span class="o">=</span> <span class="n">corrected_pad</span><span class="p">,</span>
                 <span class="n">max_range</span> <span class="o">=</span> <span class="n">max_range</span><span class="p">,</span>
                 <span class="n">computeProfiles</span> <span class="o">=</span> <span class="n">computeProfiles</span><span class="p">,</span>
                 <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="n">addProfileToDs_kwargs</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">fd</span><span class="o">.</span><span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="load.load_zarr">
    <p>def <span class="ident">load_zarr</span>(</p><p>directory=&#39;gs://ldeo-glaciology/apres/greenland/2022/single_zarrs_noencode/A101&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Load ApRES data stored in a zarr directory as an xarray and add functionality.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.load_zarr', this);">Show source &equiv;</a></p>
  <div id="source-load.load_zarr" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_zarr</span><span class="p">(</span><span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;gs://ldeo-glaciology/apres/greenland/2022/single_zarrs_noencode/A101&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load ApRES data stored in a zarr directory as an xarray and add functionality. &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span>
            <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;zarr&#39;</span><span class="p">,</span> 
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">{})</span> 
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="load.BurstObject" class="name">class <span class="ident">BurstObject</span></p>
      
  
    <div class="desc"><p>A Burst object, containing the raw data and header information for a single burst, and a method for
extracting a chirp from the burst and instantiating a ChirpObject.</p>
<p>A burst object can be instantiated with a call to DataFileObject().ExtractBurst()
e.g., Burst = fileDescriptor.ExtractBurst(3)</p>
<p>Methods:
    ExtractChirp(ChirpList (Python list))
        Output is an instance of a ChirpObject, in which all chirps in the ChirpList
        have been averaged. 
    PlotBurst()
        Plots the full raw burst as a time series</p>
<p>Instance variables:
    v         : Array containing burst data
    Filename  : Name of data file
    Header    : Burst header (Python dictionary), with additional entries:
    BurstNo   : Burst number in data file</p>
<p>Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="load.BurstObject.ExtractChirp">
    <p>def <span class="ident">ExtractChirp</span>(</p><p>self, ChirpList)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.BurstObject.ExtractChirp', this);">Show source &equiv;</a></p>
  <div id="source-load.BurstObject.ExtractChirp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ExtractChirp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ChirpList</span><span class="p">):</span>
    <span class="n">Chirp</span> <span class="o">=</span> <span class="n">ChirpObject</span><span class="p">()</span>
    <span class="n">Chirp</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span>
    <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">)</span>  <span class="c1"># we dont want chirp-specific new entries in the chirp.header updating the burst.header</span>
    <span class="n">Chirp</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="n">ChirpList</span>
    
    <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">]</span>
    <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_thisChirp&#39;</span><span class="p">])</span>\
        <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_thisChirp&#39;</span><span class="p">]):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;This is stacking over chirps with different attenuator settings.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>          
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>          
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">])</span>
        <span class="n">no</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">ChirpList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NChirps&quot;</span><span class="p">]:</span>
                <span class="n">no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">chirpoffset</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
                <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">chirpoffset</span><span class="p">:</span><span class="n">chirpoffset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;chirp index &gt; number of chirps.&quot;</span><span class="p">)</span>
        <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span> <span class="o">=</span> <span class="n">Chirp</span><span class="o">.</span><span class="n">vdat</span><span class="o">/</span><span class="n">no</span>
    <span class="k">return</span> <span class="n">Chirp</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.BurstObject.PlotBurst">
    <p>def <span class="ident">PlotBurst</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.BurstObject.PlotBurst', this);">Show source &equiv;</a></p>
  <div id="source-load.BurstObject.PlotBurst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotBurst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.25</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="load.ChirpObject" class="name">class <span class="ident">ChirpObject</span></p>
      
  
    <div class="desc"><p>An object containing the raw data and header information for a single chirp 
and a method for computing profiles (and instantiating a ProfileObject) from the chirp data.</p>
<p>Can be instantiated with a call to the ExtractChirp method on a BurstBbject
e.g., Chirp = Burst.ExtractChirp([1,3])</p>
<p>Methods:
    FormProfile(StartFreq, StopFreq, padfactor, ref)
        StartFreq, StopFreq: start and end frequencies to use (eg 2e8 and 4e8)
        padfactor:           zero padding for the fft (eg. 2)
        ref:                 whether or not to apply Paul Brennan's reference
                             phase (1 or 0, for yes or no)
        Returns and instance of a ProfileObject
    PlotChirp()
        Plots the chirp as function of time</p>
<p>Instance variables:
    vdat:       Array containing chirp data
    t:          Array containing time for chirp samples
    ChirpList:  List of chirps averaged to make vdat
    Filename:   Name of data file
    BurstNo:    Number of burst within data file
    Header:     Burst header, as created by ExtractBurst method on FileDataObject</p>
<pre><code>Created on Fri Oct 16 20:06:36 2020 by K. Nicholls
</code></pre></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="load.ChirpObject.FormProfile">
    <p>def <span class="ident">FormProfile</span>(</p><p>self, F0=200000000, F1=400000000, pad=2, ref=1, corrected_pad=False)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.ChirpObject.FormProfile', this);">Show source &equiv;</a></p>
  <div id="source-load.ChirpObject.FormProfile" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">FormProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F0</span><span class="o">=</span><span class="mi">200000000</span><span class="p">,</span> <span class="n">F1</span><span class="o">=</span><span class="mi">400000000</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">corrected_pad</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">Profile</span> <span class="o">=</span> <span class="n">ProfileObject</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">F0</span><span class="p">:</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">F1</span><span class="p">:</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="p">(</span><span class="n">F0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">F1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span>
    <span class="n">chirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdat</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">T0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]):</span>\
                      <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">])]</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chirp</span><span class="p">)</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">winchirp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">chirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nt</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">Nt</span><span class="p">))</span>
    <span class="n">Nfft</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">*</span><span class="n">pad</span><span class="p">)</span>
    <span class="n">padchirp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nfft</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">corrected_pad</span><span class="p">:</span>
        <span class="n">padchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>
        <span class="n">padchirp</span><span class="p">[</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">padchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">padchirp</span><span class="p">[</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">winchirp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">padchirp</span><span class="p">)</span><span class="o">/</span><span class="n">Nfft</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pad</span><span class="p">)</span> 
    <span class="n">Profile</span><span class="o">.</span><span class="n">bin2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">T1</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="n">pad</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">])</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nfft</span><span class="p">)])</span> <span class="o">*</span> <span class="n">Profile</span><span class="o">.</span><span class="n">bin2m</span>       
    <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Range</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Nfft</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">))])</span><span class="o">/</span><span class="n">pad</span>
        <span class="n">phiref</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">-</span>\
         <span class="n">m</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">Profile</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">phiref</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="p">))</span>
    
    <span class="n">Profile</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BurstNo</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">ChirpList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChirpList</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">pad</span>
    <span class="n">Profile</span><span class="o">.</span><span class="n">rad2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">])</span><span class="o">/</span> \
        <span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">Profile</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.ChirpObject.PlotChirp">
    <p>def <span class="ident">PlotChirp</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.ChirpObject.PlotChirp', this);">Show source &equiv;</a></p>
  <div id="source-load.ChirpObject.PlotChirp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotChirp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdat</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.25</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (V)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="load.DataFileObject" class="name">class <span class="ident">DataFileObject</span></p>
      
  
    <div class="desc"><p>An object containing information about an ApRES dat file and a method to extract bursts from it, instantiating a BurstObject.</p>
<p>Can be instantiated with one required string, giving the name of the data file
eg fileDescriptor = DataFileObject('DATAFILENAME.DAT'). </p>
<p>You can also specify whether the file is stored locally or 
remotely (on Google Cloud Storage) with the optional argument remote_load=True.</p>
<p>Methods:
    ExtractBurst(BurstNumber (integer))
        Output is an instance of a BurstObject
    e.g., Burst = fileDescriptor.ExtractBurst(3)</p>
<p>Instance variables:
    Filename           : Name of data file
    BurstLocationList  : Python list of byte offset of each burst in file
    NoBurstsInFile     : Number of bursts in the file (len(BurstLocationList))</p>
<p>Created on Fri Oct 16 20:06:36 2020 by K. Nicholls</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="load.DataFileObject.ExtractBurst">
    <p>def <span class="ident">ExtractBurst</span>(</p><p>self, BurstNo)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.DataFileObject.ExtractBurst', this);">Show source &equiv;</a></p>
  <div id="source-load.DataFileObject.ExtractBurst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ExtractBurst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BurstNo</span><span class="p">):</span>
    <span class="n">Burst</span> <span class="o">=</span> <span class="n">BurstObject</span><span class="p">()</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Filename</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">BurstNo</span> <span class="o">=</span> <span class="n">BurstNo</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;BurstNo&quot;</span><span class="p">:</span><span class="n">BurstNo</span><span class="p">}</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    
    <span class="n">datafile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="p">[</span><span class="n">BurstNo</span><span class="p">])</span>
    <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
    <span class="n">locn</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">locn1</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0D\x0A</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">locn</span><span class="p">,</span> <span class="n">locn</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">inline</span> <span class="o">=</span> <span class="n">inbuff</span><span class="p">[</span><span class="n">locn</span><span class="p">:</span><span class="n">locn1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">inline</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;End Header&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">inline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rxant&quot;</span> <span class="ow">or</span> \
               <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;txant&quot;</span> <span class="ow">or</span> \
               <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;afgain&quot;</span><span class="p">:</span>
               <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
                    
            <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;triples&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;attenuator1&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;batterycheck&quot;</span><span class="p">:</span>
                 <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
                                  
            <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;latitude&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;longitude&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;temp1&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;temp2&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;batteryvoltage&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tstepup&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tstepdn&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;fsc&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sw_issue&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;er_ice&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;position_depth_conversion&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;maxdepthtograph&quot;</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rmb_issue&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vab_issue&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg00&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg01&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg02&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg03&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0b&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0c&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0d&quot;</span> <span class="ow">or</span> \
                 <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;reg0e&quot;</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;time stamp&quot;</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
        <span class="n">locn</span> <span class="o">=</span> <span class="n">locn1</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">locn1</span> <span class="o">=</span> <span class="n">inbuff</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x0D\x0A</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">locn</span><span class="p">,</span><span class="n">locn</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span>
        <span class="n">inline</span> <span class="o">=</span> <span class="n">inbuff</span><span class="p">[</span><span class="n">locn</span><span class="p">:</span><span class="n">locn1</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="c1"># Re-open the file for binary read to get burst data</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>      
    
    <span class="n">datafile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BurstLocationList</span><span class="p">[</span><span class="n">BurstNo</span><span class="p">]</span> <span class="o">+</span> <span class="n">locn1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
        <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">*</span><span class="mf">2.5</span><span class="o">-</span><span class="mf">1.25</span>
    <span class="k">elif</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;Average&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span>
        <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">NsamplesInBurst</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;N_ADC_SAMPLES&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span> <span class="o">*</span>  <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;nAttenuators&quot;</span><span class="p">]</span>  <span class="c1"># because each subburst contains a certain number of chirps given by Burst.Header[&quot;nAttenuators&quot;]</span>
        <span class="n">inbuff</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">NsamplesInBurst</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">*</span><span class="mf">2.5</span><span class="o">-</span><span class="mf">1.25</span>
    <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="s2">&quot;SamplingFreqMode&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;SamplingFreqMode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">40000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">80000</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">40000</span>
        
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NChirps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;NSubBursts&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;nAttenuators&quot;</span><span class="p">]</span> <span class="o">*</span>\
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;TxAnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;RxAnt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s2">&quot;FreqStepUp&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">:</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;FreqStepUp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;TStepUp&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;K&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2e8</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2e8</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4e8</span>
        
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3e8</span>
    <span class="k">if</span>  <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;ER_ICE&quot;</span> <span class="ow">in</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">):</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;ER_ICE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.18</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;CentreFreq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StopFreq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s2">&quot;StartFreq&quot;</span><span class="p">])</span>
    
    <span class="c1"># deal out attenuator settings to the chirps</span>
    <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">]</span> <span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">chirp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;NChirps&#39;</span><span class="p">]):</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1_allChirps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;Attenuator1&#39;</span><span class="p">][</span><span class="n">setting_counter</span><span class="p">])</span>
        <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain_allChirps&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;AFGain&#39;</span><span class="p">][</span><span class="n">setting_counter</span><span class="p">])</span>
        
        <span class="c1"># keep track of which setting to use</span>
        <span class="n">setting_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">setting_counter</span> <span class="o">&gt;=</span> <span class="n">Burst</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s1">&#39;nAttenuators&#39;</span><span class="p">]:</span> <span class="c1"># if the counter reaches nAttenuators, reset it to zero </span>
            <span class="n">setting_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">Burst</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="load.ProfileObject" class="name">class <span class="ident">ProfileObject</span></p>
      
  
    <div class="desc"><p>An object containing the profile data and header information for a single profile.
Also includes a function for plotting the profile (which is not used in the rest of the module).</p>
<p>Can be instantiated with a call to the FormProfile method on a ChirpObject
e.g., Profile = Chirp.FormProfile(StartFreq, StopFreq, padfactor, ref)</p>
<p>Methods:
    PlotProfile(MaxDepth (double))
        MaxDepth:  Maximum depth (in metres) to which to plot profile</p>
<p>Instance variables:
    Range:     Array with depth in metres each profile depth bin
    Profile:   Array containing profile (complex double)
    F0:        Start frequency used to form profile
    F1:        End frequency used to form profile
    pad:       Pad factor used when zeropadding
    ChirpList: List of chirps averaged to form profile
    Filename:  Name of original data file 
    BurstNo:   Number of burst in data file
    Header:    Burst header, as produced using ExtractBurst method on DataFileObject 
    rad2m:     radians to metres of range conversion factor
    bin2m:     bin to metres of range conversion factor</p>
<pre><code>Created on Fri Oct 16 20:06:36 2020 by K. Nicholls
</code></pre></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="load.ProfileObject.PlotProfile">
    <p>def <span class="ident">PlotProfile</span>(</p><p>self, dmax)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.ProfileObject.PlotProfile', this);">Show source &equiv;</a></p>
  <div id="source-load.ProfileObject.PlotProfile" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotProfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dmax</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Range</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Profile</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Range (m)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Amplitude (dB)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">)</span>
    <span class="k">return</span> 
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="load.from_dats" class="name">class <span class="ident">from_dats</span></p>
      
  
    <div class="desc"><p>An object containing ApRES data loaded from a dat file or many dat files, along with information about the data. </p>
<p>Can be instantiated with 2 optional keyword arguments, loglevel and max_range</p>
<p>Argument:
    loglevel &mdash; allows the user to select the level of logging messages are displayed. 
    The default loglevel is warning, which means that no messages are displayed. 
    If you want to see detailed log messages, use loglevel = 'debug'</p>
<p>Methods:
    load_single &mdash; load a single chirp from a single burst from a single dat file
    load_dat_file &mdash; load a dat file as a DataFileObject
    list_files &mdash; recursively find  all the files in a directory or a google bucket
    load_all &mdash; load all the files found in a directory or google bucket into an xarray</p>
<p>load_all is the most important method. Call it, for example, as follows:</p>
<pre><code>import ApRESDefs
xa = ApRESDefs.xapres(loglevel='debug', max_range=1400)
xa.load_all(directory='gs://ldeo-glaciology/GL_apres_2022', 
            remote_load = True,
            file_numbers_to_process = [0, 1], 
            bursts_to_process=[0, 1]
        )
</code></pre>
<p>the resulting xarray will be saved in xa.data.</p>
<p>Instance variables:
    Filename           : Name of data file
    BurstLocationList  : Python list of byte offset of each burst in file
    NoBurstsInFile     : Number of bursts in the file (len(BurstLocationList))</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="load.from_dats.correct_temperature">
    <p>def <span class="ident">correct_temperature</span>(</p><p>self, threshold=300, correction=-512)</p>
    </div>
    

    
  
    <div class="desc"><p>Correct temperature values that are above a certain threshold. This appears to result from the temperature data being in the wrong format.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.correct_temperature', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.correct_temperature" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">correct_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">correction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct temperature values that are above a certain threshold. This appears to result from the temperature data being in the wrong format.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correct temperature values above </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> by adding </span><span class="si">{</span><span class="n">correction</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_1&#39;</span><span class="p">]</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_2&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">T1</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">T1</span><span class="o">+</span><span class="n">correction</span><span class="p">,</span> <span class="n">T1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;temperature_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">T2</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">,</span> <span class="n">T2</span><span class="o">+</span><span class="n">correction</span><span class="p">,</span> <span class="n">T2</span><span class="p">)</span> 
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.is_this_a_remote_load">
    <p>def <span class="ident">is_this_a_remote_load</span>(</p><p>self, filename=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Detect if we are trying to load from Google Cloud Storage based on the filename being supplied</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.is_this_a_remote_load', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.is_this_a_remote_load" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_this_a_remote_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if we are trying to load from Google Cloud Storage based on the filename being supplied&quot;&quot;&quot;</span>
    
    <span class="n">name_to_check_for_gs</span> <span class="o">=</span> <span class="n">filename</span> <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span> <span class="o">=</span> <span class="s2">&quot;gs://&quot;</span> <span class="ow">in</span> <span class="n">name_to_check_for_gs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;remote_load set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.list_files">
    <p>def <span class="ident">list_files</span>(</p><p>self, directory=None, search_suffix=&#39;&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Recursively list all the .DAT files in a given location dir. </p>
<p>Arguments:
directory &ndash; the directory that will be looked in recursivly to find .DAT files.
search_suffix &ndash; a string that can be used to search for files with a specific suffix.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.list_files', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.list_files" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">list_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
               <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
               <span class="n">search_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
               <span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recursively list all the .DAT files in a given location dir. </span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">    directory -- the directory that will be looked in recursivly to find .DAT files.</span>
<span class="sd">    search_suffix -- a string that can be used to search for files with a specific suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Find all the dat files in the directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">:</span>   
        <span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">()</span>
        <span class="n">dat_filenames_without_gs_prefix</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="o">+</span> <span class="n">search_suffix</span> <span class="o">+</span> <span class="s1">&#39;.[dD][aA][tT]&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">dat_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gs://&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dat_filenames_without_gs_prefix</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dat_filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/**/*&#39;</span> <span class="o">+</span> <span class="n">search_suffix</span>  <span class="o">+</span><span class="s1">&#39;.[dD][aA][tT]&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span> <span class="o">=</span> <span class="n">dat_filenames</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to list_files. Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dat_filenames</span><span class="p">)</span><span class="si">}</span><span class="s2"> files&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dat_filenames</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.load_all">
    <p>def <span class="ident">load_all</span>(</p><p>self, directory=None, remote_load=None, file_numbers_to_process=None, file_names_to_process=None, bursts_to_process=&#39;All&#39;, attended=False, polarmetric=False, legacy_fft=False, corrected_pad=False, max_range=None, computeProfiles=True, addProfileToDs_kwargs={})</p>
    </div>
    

    
  
    <div class="desc"><p>Method to recursively ApRES .dat files and put them in an xarray dataset. It also computes profiles from the chirp data 
and includes them in the output. </p>
<p>This method has two modes. One for unattended ApRES data and one for attended data. </p>
<p>For unattended data (i.e. attended=False, the default), it puts all the data from all 
the .DAT files found recursively in 'directory', into one xarray. The most important 
dimension of this xarray is 'time', which is the time of each burst. </p>
<p>In attended mode, the method locates the dat files corresponding to each waypoint. 
It does this based on a user-supplied list of directories 'directory'. The method groups the 
data by waypoint (and optionally antenna orientation).</p>
<h2 id="parameters">Parameters</h2>
<p>directory : str or list, optional
    Directory or list of directories containing .DAT files. 
    If attended is False, this should be a single directory which will be search recusrivley for dat fies.<br>
    If attended is True, this should be a list of directories, one for each waypoint. Default is None.
file_numbers_to_process : list, optional
    List of file numbers to process. If None, all files will be processed. Default is None.
file_names_to_process : list, optional
    List of file names to process. If None, all files will be processed. Default is None. 
    Note that you can set either file_numbers_to_process or file_names_to_process, but not both. 
bursts_to_process : str or list, optional
    Bursts to process from within each dat file. Default is "All".
attended : bool, optional
    If True, load data in attended mode. Default is False.
polarmetric : bool, optional
    If True, load data in polarmetric mode - the xarray dataset outputted will have an antenna-orientation dimension corrosponding to HH, HV, VH, and VV. 
    It designates dat files to each orientation based on the files names containing HH, HV, VH, or VV.
    Default is False.
legacy_fft : bool, optional
    If True, use legacy FFT processing. Default is True.
corrected_pad : bool, optional
    If True, use the corrected padding procedure in the legacy fft processing.
    The original erroneously replaced a two data points in each chirp with zeros. Default is False.
max_range : float, optional
    A range value used to crop the profiles. Only used in the legacy fft processing. Default is None.
computeProfiles : bool, optional
    If True, compute profiles from the chirp data. Default is True.
addProfileToDs_kwargs : dict, optional
    Additional keyword arguments for addProfileToDs method. 
    The following can be set:
        pad_factor = 2
        drop_noisy_chirps = False,
        clip_threshold = 1.2,
        min_chirps = 20,
        demean = False,
        detrend = False,
        stack = False,
        crop_chirp_start = None,
        crop_chirp_end = None,
        max_range = None</p>
<h2 id="returns">Returns</h2>
<p>xarray.Dataset
    The loaded data as an xarray dataset.</p>
<h2 id="raises">Raises</h2>
<p>ValueError
    If attended mode is True and directory_list is None.
    If both file_numbers_to_process and file_names_to_process are supplied.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.load_all', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.load_all" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">remote_load</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">file_numbers_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">file_names_to_process</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">bursts_to_process</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">,</span>
             <span class="n">attended</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
             <span class="n">polarmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">legacy_fft</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">corrected_pad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">max_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">computeProfiles</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">addProfileToDs_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
             <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to recursively ApRES .dat files and put them in an xarray dataset. It also computes profiles from the chirp data </span>
<span class="sd">    and includes them in the output. </span>
<span class="sd">    </span>
<span class="sd">    This method has two modes. One for unattended ApRES data and one for attended data. </span>
<span class="sd">    </span>
<span class="sd">    For unattended data (i.e. attended=False, the default), it puts all the data from all </span>
<span class="sd">    the .DAT files found recursively in &#39;directory&#39;, into one xarray. The most important </span>
<span class="sd">    dimension of this xarray is &#39;time&#39;, which is the time of each burst. </span>
<span class="sd">    In attended mode, the method locates the dat files corresponding to each waypoint. </span>
<span class="sd">    It does this based on a user-supplied list of directories &#39;directory&#39;. The method groups the </span>
<span class="sd">    data by waypoint (and optionally antenna orientation).</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    directory : str or list, optional</span>
<span class="sd">        Directory or list of directories containing .DAT files. </span>
<span class="sd">        If attended is False, this should be a single directory which will be search recusrivley for dat fies.  </span>
<span class="sd">        If attended is True, this should be a list of directories, one for each waypoint. Default is None.</span>
<span class="sd">    file_numbers_to_process : list, optional</span>
<span class="sd">        List of file numbers to process. If None, all files will be processed. Default is None.</span>
<span class="sd">    file_names_to_process : list, optional</span>
<span class="sd">        List of file names to process. If None, all files will be processed. Default is None. </span>
<span class="sd">        Note that you can set either file_numbers_to_process or file_names_to_process, but not both. </span>
<span class="sd">    bursts_to_process : str or list, optional</span>
<span class="sd">        Bursts to process from within each dat file. Default is &quot;All&quot;.</span>
<span class="sd">    attended : bool, optional</span>
<span class="sd">        If True, load data in attended mode. Default is False.</span>
<span class="sd">    polarmetric : bool, optional</span>
<span class="sd">        If True, load data in polarmetric mode - the xarray dataset outputted will have an antenna-orientation dimension corrosponding to HH, HV, VH, and VV. </span>
<span class="sd">        It designates dat files to each orientation based on the files names containing HH, HV, VH, or VV.</span>
<span class="sd">        Default is False.</span>
<span class="sd">    legacy_fft : bool, optional</span>
<span class="sd">        If True, use legacy FFT processing. Default is True.</span>
<span class="sd">    corrected_pad : bool, optional</span>
<span class="sd">        If True, use the corrected padding procedure in the legacy fft processing.</span>
<span class="sd">        The original erroneously replaced a two data points in each chirp with zeros. Default is False.</span>
<span class="sd">    max_range : float, optional</span>
<span class="sd">        A range value used to crop the profiles. Only used in the legacy fft processing. Default is None.</span>
<span class="sd">    computeProfiles : bool, optional</span>
<span class="sd">        If True, compute profiles from the chirp data. Default is True.</span>
<span class="sd">    addProfileToDs_kwargs : dict, optional</span>
<span class="sd">        Additional keyword arguments for addProfileToDs method. </span>
<span class="sd">        The following can be set:</span>
<span class="sd">            pad_factor = 2</span>
<span class="sd">            drop_noisy_chirps = False,</span>
<span class="sd">            clip_threshold = 1.2,</span>
<span class="sd">            min_chirps = 20,</span>
<span class="sd">            demean = False,</span>
<span class="sd">            detrend = False,</span>
<span class="sd">            stack = False,</span>
<span class="sd">            crop_chirp_start = None,</span>
<span class="sd">            crop_chirp_end = None,</span>
<span class="sd">            max_range = None</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xarray.Dataset</span>
<span class="sd">        The loaded data as an xarray dataset.</span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If attended mode is True and directory_list is None.</span>
<span class="sd">        If both file_numbers_to_process and file_names_to_process are supplied.</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="o">=</span> <span class="n">file_numbers_to_process</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="o">=</span> <span class="n">file_names_to_process</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attended</span> <span class="o">=</span> <span class="n">attended</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">burst_load_counter</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># this will increment each time a burst is loaded by _burst_to_xarray</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">polarmetric</span> <span class="o">=</span> <span class="n">polarmetric</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span> <span class="o">=</span> <span class="n">legacy_fft</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">corrected_pad</span> <span class="o">=</span> <span class="n">corrected_pad</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span> <span class="o">=</span> <span class="n">max_range</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">computeProfiles</span> <span class="o">=</span> <span class="n">computeProfiles</span>
    <span class="c1">#self.bursts_to_process = bursts_to_process</span>
    
    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start call to load_all with remote_load = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="si">}</span><span class="s2">, directory = </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">, file_numbers_to_process = </span><span class="si">{</span><span class="n">file_numbers_to_process</span><span class="si">}</span><span class="s2">, file_names_to_process = </span><span class="si">{</span><span class="n">file_names_to_process</span><span class="si">}</span><span class="s2">, bursts_to_process = </span><span class="si">{</span><span class="n">bursts_to_process</span><span class="si">}</span><span class="s2">, attended = </span><span class="si">{</span><span class="n">attended</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  
    
    
    <span class="k">if</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">directory_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">directory_list</span> <span class="o">=</span> <span class="n">directory</span>
    <span class="k">if</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>    <span class="c1"># adds self.dat_filenames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subset_files</span><span class="p">()</span>   <span class="c1"># adds self.dat_filenames_to_process</span>
    
        <span class="c1"># Loop through the dat files, putting individual xarrays in a list.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attended is False, so starting loop over dat files&quot;</span><span class="p">)</span>
        <span class="n">list_of_multiBurstxarrays</span> <span class="o">=</span> <span class="p">[]</span>   
        <span class="k">for</span> <span class="n">dat_filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Load dat file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dat_file</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>
            
            <span class="n">multiBurstxarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_bursts_in_dat_to_xarray</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">bursts_to_process</span><span class="p">)</span>
        
            <span class="n">list_of_multiBurstxarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiBurstxarray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished processing file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attended is False, so concatenating all the multi-burst xarrays along the time dimension, to create xapres.data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_multiBurstxarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> 
    
        
    <span class="k">elif</span> <span class="n">attended</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">directory_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Throwing a ValueError because directory_list is None and attended is True: when loaded data taken in attended mode, you must supply a list of directory names.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When loading data taken in attended mode, you must supply a list, directory_list, with the names of directories containing dat files from each waypoint.&quot;</span><span class="p">)</span>
        
        <span class="c1"># loop over the waypoints, as defined by the directories in the user-supplied list, directory_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Attended is True, so starting loop over directories (each corresponding to a waypoint)&quot;</span><span class="p">)</span>
        <span class="n">list_of_singlewaypoint_xarrays</span> <span class="o">=</span> <span class="p">[]</span>   
        
        <span class="k">for</span> <span class="n">waypoint_number</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">directory_list</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Looking in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> for dat files from waypoint </span><span class="si">{</span><span class="n">waypoint_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">singlewaypoint_xarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_bursts_at_waypoint_to_xarray</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">waypoint_number</span><span class="p">)</span>
            <span class="n">list_of_singlewaypoint_xarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">singlewaypoint_xarray</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished processing files f-in directory </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> waypoint </span><span class="si">{</span><span class="n">waypoint_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attended is True, so concatenating all the single-waypoint xarrays along the waypoint dimension, to create xapres.data&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_singlewaypoint_xarrays</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;waypoint&#39;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_attrs</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">correct_temperature</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_fft</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeProfiles</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call addProfileToDs to add the profiles to the xarray&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">addProfileToDs</span><span class="p">(</span><span class="o">**</span><span class="n">addProfileToDs_kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to load_all. Call xapres.data to see the xarray this produced.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.load_dat_file">
    <p>def <span class="ident">load_dat_file</span>(</p><p>self, dat_filename)</p>
    </div>
    

    
  
    <div class="desc"><p>Return a DataFileObject, given a filename.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.load_dat_file', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.load_dat_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_dat_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat_filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a DataFileObject, given a filename.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DataFileObject</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_load</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.load_single">
    <p>def <span class="ident">load_single</span>(</p><p>self, dat_filename, burst_number=0, chirp_num=0)</p>
    </div>
    

    
  
    <div class="desc"><p>Load a single chirp, from a single burst, from a single data file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.load_single', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.load_single" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">dat_filename</span><span class="p">,</span> 
                <span class="n">burst_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                <span class="n">chirp_num</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a single chirp, from a single burst, from a single data file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_this_a_remote_load</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">files_to_be_processed</span> <span class="o">=</span> <span class="n">dat_filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Load dat file </span><span class="si">{</span><span class="n">dat_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_dat_file</span><span class="p">(</span><span class="n">dat_filename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract burst number </span><span class="si">{</span><span class="n">burst_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_burst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_dat</span><span class="o">.</span><span class="n">ExtractBurst</span><span class="p">(</span><span class="n">burst_number</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extract chirp number </span><span class="si">{</span><span class="n">chirp_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_chirp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_burst</span><span class="o">.</span><span class="n">ExtractChirp</span><span class="p">([</span><span class="n">chirp_num</span><span class="p">])</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Form profile for chirp number </span><span class="si">{</span><span class="n">chirp_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">single_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_chirp</span><span class="o">.</span><span class="n">FormProfile</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finish call to load_single.&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="load.from_dats.subset_files">
    <p>def <span class="ident">subset_files</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Subset files based on either file_numbers_to_process or file_names_to_process. Throws an error if both are supplied. This only gets used for unattended data.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-load.from_dats.subset_files', this);">Show source &equiv;</a></p>
  <div id="source-load.from_dats.subset_files" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">subset_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subset files based on either file_numbers_to_process or file_names_to_process. Throws an error if both are supplied. This only gets used for unattended data.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Throwing a ValueError because file_numbers_to_process and file_names_to_process cannot both be supplied to load_all&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;file_numbers_to_process and file_names_to_process cannot both be supplied to load_all. You need to supply just one (or neither) of these.&quot;</span><span class="p">)</span> 
    
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because file_numbers_to_process == </span><span class="se">\&quot;</span><span class="s2">all</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subset files to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span><span class="p">]</span>
    
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because file_names_to_process == </span><span class="se">\&quot;</span><span class="s2">all</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>
        <span class="k">else</span><span class="p">:</span>                 
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Subset files to list of files supplied in file_names_to_process&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span>
                        
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_numbers_to_process</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_names_to_process</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>      <span class="c1"># default is all the dat files    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Selecting all dats file because neither file_numbers_to_process nor file_names_to_process were supplied&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dat_filenames</span>          
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>
</article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Generated by <a href="https://github.com/timothycrosley/pdocs">pdocs 1.2.0</a>
    </p>
  </footer>
</div>
</body>
</html>